
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>visualisation &#8212; Skill-Based Career Prediction and Market Insights Using Machine Learning and Hollands Code 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for visualisation</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">visualisation: Functions to display various dynamic plots.</span>
<span class="sd">This module contains functions to show interactive visualizations.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">panel</span> <span class="k">as</span> <span class="nn">pn</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">VBox</span><span class="p">,</span> <span class="n">HBox</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>

<span class="kn">from</span> <span class="nn">data_preprocessing</span> <span class="kn">import</span> <span class="n">load_and_clean_wage_data</span><span class="p">,</span> <span class="n">load_and_clean_skills_occupation_data</span>

<div class="viewcode-block" id="get_top_5_matrix_codes"><a class="viewcode-back" href="../modules.html#visualisation.get_top_5_matrix_codes">[docs]</a><span class="k">def</span> <span class="nf">get_top_5_matrix_codes</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">top_5_label_global</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Retrieves the matrix codes for the top 5 job titles.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): DataFrame containing job matrix data.</span>
<span class="sd">        top_5_labels_global (list): List of top 5 job titles.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of the corresponding matrix codes for the selected job titles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">top_5_codes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">top_5_label_global</span><span class="p">:</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;2023 National Employment Matrix title&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">title</span><span class="p">]</span>\
            <span class="p">[</span><span class="s1">&#39;2023 National Employment Matrix code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">top_5_codes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">code</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">top_5_codes</span></div>


<div class="viewcode-block" id="plot_wage_vs_employment"><a class="viewcode-back" href="../modules.html#visualisation.plot_wage_vs_employment">[docs]</a><span class="k">def</span> <span class="nf">plot_wage_vs_employment</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">matrix_codes</span><span class="p">,</span> <span class="n">job_titles</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a scatter plot comparing wages and total employment for selected job titles.</span>
<span class="sd">    The data used is the `national_M2023_dl.xlsx` under project_data folder.</span>
<span class="sd">    The path of the data should be &#39;.project_data/oesm23nat/national_M2023_dl.xlsx&#39;</span>

<span class="sd">    Args:</span>
<span class="sd">        df (DataFrame): Dataframe containing the occupation title and occupation code.</span>
<span class="sd">        matrix_codes (list): List of matrix codes corresponding to job titles.</span>
<span class="sd">        job_titles (list): List of job titles for comparison.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pn.pane.Plotly: A Plotly figure wrapped in Panel for display.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">((</span><span class="n">cwd</span><span class="o">/</span><span class="s1">&#39;project_data/oesm23nat/national_M2023_dl.xlsx&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>

    <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OCC_CODE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">matrix_codes</span><span class="p">)]</span>

    <span class="n">job_title_lower</span> <span class="o">=</span> <span class="p">[</span><span class="n">jb</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">jb</span> <span class="ow">in</span> <span class="n">job_titles</span><span class="p">]</span>
    <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="p">[</span><span class="o">~</span><span class="n">filtered_data</span><span class="p">[</span><span class="s1">&#39;OCC_TITLE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">job_title_lower</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;No data found for the selected matrix codes,</span><span class="se">\</span>
<span class="s2">                                 excluding selected titles.&quot;</span><span class="p">)</span>

    <span class="n">filtered_data</span><span class="p">[</span><span class="s1">&#39;OCC_PREFIX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="p">[</span><span class="s1">&#39;OCC_CODE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">color_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">prefix</span><span class="p">:</span> <span class="n">px</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">qualitative</span><span class="o">.</span><span class="n">Set1</span>\
                 <span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">px</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">qualitative</span><span class="o">.</span><span class="n">Set1</span><span class="p">)]</span> \
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">[</span><span class="s1">&#39;OCC_PREFIX&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())}</span>
    <span class="n">filtered_data</span><span class="p">[</span><span class="s1">&#39;Color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="p">[</span><span class="s1">&#39;OCC_PREFIX&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">color_map</span><span class="p">)</span>

    <span class="n">occ_prefix_to_titles</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">job_titles</span><span class="p">:</span>
        <span class="n">matrix_code</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;2023 National Employment Matrix title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="n">title</span><span class="p">]</span>\
            <span class="p">[</span><span class="s1">&#39;2023 National Employment Matrix code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matrix_code</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">matrix_code</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Get the first two digits of the matrix code (OCC_PREFIX)</span>
            <span class="n">occ_prefix_to_titles</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span>  <span class="c1"># Map OCC_PREFIX to the selected job title</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">filtered_data</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="s1">&#39;TOT_EMP&#39;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s1">&#39;A_MEAN&#39;</span><span class="p">,</span>
        <span class="n">hover_data</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;OCC_TITLE&#39;</span><span class="p">],</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Wage vs. Total Employment for Selected Job Groups&quot;</span><span class="p">,</span>
        <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;TOT_EMP&#39;</span><span class="p">:</span> <span class="s1">&#39;Total Employment&#39;</span><span class="p">,</span> <span class="s1">&#39;A_MEAN&#39;</span><span class="p">:</span> <span class="s1">&#39;Average Mean Wage&#39;</span><span class="p">},</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;OCC_PREFIX&#39;</span><span class="p">,</span>
        <span class="n">color_discrete_map</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">400</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">for_each_trace</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">occ_prefix_to_titles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">Plotly</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span></div>

<div class="viewcode-block" id="create_interactive_wage_plot"><a class="viewcode-back" href="../modules.html#visualisation.create_interactive_wage_plot">[docs]</a><span class="k">def</span> <span class="nf">create_interactive_wage_plot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">result_widget_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an interactive wage plot based on selected job groups.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): DataFrame containing job matrix data.</span>
<span class="sd">        result_widget_name (list): List of job titles for interactive selection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pn.Column: A Panel layout containing the interactive widgets and plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result_widget</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">MultiSelect</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Select Job Groups&quot;</span><span class="p">,</span>
                                           <span class="n">options</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">result_widget_name</span><span class="p">),</span>
                                           <span class="n">value</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">result_widget_name</span><span class="p">),</span>
                                           <span class="n">height</span><span class="o">=</span><span class="mi">110</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">450</span><span class="p">)</span>
    <span class="n">result_widget</span><span class="o">.</span><span class="n">margin</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_wage_data</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper function to generate wage vs. employment plot based on selected job groups.&quot;&quot;&quot;</span>
        <span class="n">selected_titles</span> <span class="o">=</span> <span class="n">result</span>
        <span class="n">matrix_codes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;2023 National Employment Matrix title&#39;</span><span class="p">]</span>\
                          <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">selected_titles</span><span class="p">)]</span>\
                            <span class="p">[</span><span class="s1">&#39;2023 National Employment Matrix code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matrix_codes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;No valid job titles selected or matching.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">plot_wage_vs_employment</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">matrix_codes</span><span class="p">,</span> <span class="n">selected_titles</span><span class="p">)</span>

    <span class="n">interaction</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">plot_wage_data</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">result_widget</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
        <span class="n">pn</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span><span class="n">pn</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span>\
            <span class="s2">&quot;## Top Job Groups by 2023 Annual Median Wage and Total Employment&quot;</span><span class="p">),</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">),</span>
        <span class="n">interaction</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">interaction</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">servable</span><span class="p">()</span></div>

<div class="viewcode-block" id="plot_wage_data_by_prefix"><a class="viewcode-back" href="../modules.html#visualisation.plot_wage_data_by_prefix">[docs]</a><span class="k">def</span> <span class="nf">plot_wage_data_by_prefix</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the job codes for the selected prefixes, filters the wage data </span>
<span class="sd">    based on those job codes,and generates a Plotly bar chart for the top 10 </span>
<span class="sd">    occupations based on their average median wage.</span>

<span class="sd">    This function performs the following steps:</span>
<span class="sd">    1. Filters the job codes based on the selected job prefixes.</span>
<span class="sd">    2. Filters the wage data based on the retrieved job codes and sorts it by average median wage.</span>
<span class="sd">    3. Creates a Plotly bar chart for the top 10 occupations based on their average median wage.</span>

<span class="sd">    Args:</span>
<span class="sd">        result (list): A list of job prefix strings selected by the user (e.g., [&#39;15&#39;, &#39;17&#39;]).</span>

<span class="sd">    Returns:</span>
<span class="sd">        pn.pane.Plotly or pn.pane.Markdown: </span>
<span class="sd">            - A Plotly chart displaying the top 10 jobs with the highest average median wage.</span>
<span class="sd">            - A Markdown message indicating that no data is available if no matching </span>
<span class="sd">            job codes are found.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">skills_6_1</span> <span class="o">=</span> <span class="n">load_and_clean_skills_occupation_data</span><span class="p">()</span>
    <span class="n">wage_data_filepath</span> <span class="o">=</span> <span class="s2">&quot;project_data/oesm23nat/national_M2023_dl.xlsx&quot;</span>
    <span class="n">wage_2023</span> <span class="o">=</span> <span class="n">load_and_clean_wage_data</span><span class="p">(</span><span class="n">wage_data_filepath</span><span class="p">)</span>

    <span class="n">job_codes</span> <span class="o">=</span> <span class="n">skills_6_1</span><span class="p">[</span><span class="n">skills_6_1</span><span class="p">[</span><span class="s1">&#39;2023 National Employment Matrix title&#39;</span><span class="p">]</span>
                   <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                   <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">result</span><span class="p">))][</span><span class="s1">&#39;2023 National Employment Matrix code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="n">wage_2023</span><span class="o">.</span><span class="n">OCC_CODE</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">job_codes</span><span class="p">))</span>
    <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">wage_2023</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;A_MEAN&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span>\
            <span class="s2">&quot;No data available for the selected job prefixes.&quot;</span><span class="p">)</span>

    <span class="n">top_10_data</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">top_10_data</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="s1">&#39;A_MEAN&#39;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s1">&#39;OCC_TITLE&#39;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Top 10 Jobs by 2023 Annual Median Wage&quot;</span><span class="p">,</span>
        <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;OCC_TITLE&#39;</span><span class="p">:</span> <span class="s1">&#39;Occupation Title&#39;</span><span class="p">,</span> <span class="s1">&#39;A_MEAN&#39;</span><span class="p">:</span> <span class="s1">&#39;Average Median Wage&#39;</span><span class="p">},</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;A_MEAN&#39;</span><span class="p">,</span>
        <span class="n">color_continuous_scale</span><span class="o">=</span><span class="s1">&#39;Viridis&#39;</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">400</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Occupation Title&#39;</span><span class="p">,</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Average Median Wage&#39;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">Plotly</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1500</span><span class="p">)</span></div>

<div class="viewcode-block" id="create_interactive_job_prefix_plot"><a class="viewcode-back" href="../modules.html#visualisation.create_interactive_job_prefix_plot">[docs]</a><span class="k">def</span> <span class="nf">create_interactive_job_prefix_plot</span><span class="p">(</span><span class="n">skills_6_1</span><span class="p">,</span> <span class="n">top_5_codes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an interactive plot for selecting job prefixes and displaying corresponding wage data.</span>

<span class="sd">    This function generates a MultiSelect widget based on the `top_5_codes` list, which contains</span>
<span class="sd">    the prefixes of the 2023 National Employment Matrix codes. It then filters the `skills_6_1`</span>
<span class="sd">    DataFrame based on these prefixes to show the corresponding job titles.</span>
<span class="sd">    The selected job prefixes used for a plot displaying the top 10 jobs by median wage.</span>

<span class="sd">    Args:</span>
<span class="sd">        skills_6_1 (pd.DataFrame): A DataFrame containing skills and occupation data, including </span>
<span class="sd">        job titles and corresponding matrix codes.</span>

<span class="sd">        top_5_codes (list of str): A list of the top 5 matrix code prefixes used to filter</span>
<span class="sd">        job titles.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pn.Column: A Panel layout containing the interactive widgets and plot.</span>

<span class="sd">    Example:</span>
<span class="sd">        skills_6_1 = pd.read_excel(&quot;path_to_skills_data.xlsx&quot;)</span>
<span class="sd">        top_5_codes = [&#39;15&#39;, &#39;17&#39;, &#39;11&#39;, &#39;13&#39;, &#39;23&#39;]</span>
<span class="sd">        plot = create_interactive_job_prefix_plot(skills_6_1, top_5_codes)</span>
<span class="sd">        plot.servable()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">skills_6_1</span> <span class="o">=</span> <span class="n">load_and_clean_skills_occupation_data</span><span class="p">()</span>

    <span class="n">occ_code_mask</span> <span class="o">=</span> <span class="n">skills_6_1</span><span class="p">[</span><span class="s1">&#39;2023 National Employment Matrix code&#39;</span><span class="p">]</span>\
        <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">top_5_codes</span><span class="p">))</span>
    <span class="n">job_prefix_names</span> <span class="o">=</span> <span class="n">skills_6_1</span><span class="p">[</span><span class="n">occ_code_mask</span><span class="p">][</span><span class="s1">&#39;2023 National Employment Matrix title&#39;</span><span class="p">]</span>\
        <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>

    <span class="n">result_widget</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">MultiSelect</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Select Job Prefixes&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">job_prefix_names</span><span class="p">),</span>
        <span class="n">value</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">job_prefix_names</span><span class="p">),</span>  <span class="c1"># Default to all selected</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">450</span>
    <span class="p">)</span>
    <span class="n">result_widget</span><span class="o">.</span><span class="n">margin</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">interaction</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">plot_wage_data_by_prefix</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">result_widget</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
        <span class="n">pn</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span><span class="n">pn</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;## Top 10 Jobs by 2023 Annual Median Wage Data&quot;</span><span class="p">),</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">),</span>
        <span class="n">interaction</span><span class="p">,</span>
    <span class="p">)</span></div>

<span class="c1"># Global variables to store results</span>
<span class="n">top_5_labels_global</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">top_5_probs_global</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="riasec_prediction_model"><a class="viewcode-back" href="../modules.html#visualisation.riasec_prediction_model">[docs]</a><span class="k">def</span> <span class="nf">riasec_prediction_model</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Trains a RIASEC-based job prediction model and allows the user to input their </span>
<span class="sd">    RIASEC scores to get job predictions.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): A DataFrame containing the necessary features and target for </span>
<span class="sd">                           training the model. The DataFrame should have columns for RIASEC </span>
<span class="sd">                           attributes, such as: &#39;Mechanical&#39;, &#39;Physical strength and stamina&#39;, </span>
<span class="sd">                           &#39;Fine motor&#39;, etc. Additionally, it must contain </span>
<span class="sd">                           &#39;2023 National Employment Matrix code&#39; </span>
<span class="sd">                           and &#39;2023 National Employment Matrix title&#39;.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        None: This function displays the user interface and updates the global variables </span>
<span class="sd">        `top_5_labels_global`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">riasec_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Realistic&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Mechanical&#39;</span><span class="p">,</span> <span class="s1">&#39;Physical strength and stamina&#39;</span><span class="p">,</span> <span class="s1">&#39;Fine motor&#39;</span><span class="p">],</span>
        <span class="s1">&#39;Investigative&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Science&#39;</span><span class="p">,</span> <span class="s1">&#39;Mathematics&#39;</span><span class="p">,</span> <span class="s1">&#39;Critical and analytical thinking&#39;</span><span class="p">],</span>
        <span class="s1">&#39;Artistic&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Creativity and innovation&#39;</span><span class="p">,</span> <span class="s1">&#39;Writing and reading&#39;</span><span class="p">],</span>
        <span class="s1">&#39;Social&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Interpersonal&#39;</span><span class="p">,</span> <span class="s1">&#39;Speaking and listening&#39;</span><span class="p">,</span> <span class="s1">&#39;Customer service&#39;</span><span class="p">],</span>
        <span class="s1">&#39;Enterprising&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Leadership&#39;</span><span class="p">,</span> <span class="s1">&#39;Project management&#39;</span><span class="p">,</span> 
                         <span class="s1">&#39;Problem solving and decision making&#39;</span><span class="p">,</span> <span class="s1">&#39;Adaptability&#39;</span><span class="p">],</span>
        <span class="s1">&#39;Conventional&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Computers and information technology&#39;</span><span class="p">,</span> <span class="s1">&#39;Detail oriented&#39;</span><span class="p">,</span> <span class="s1">&#39;Adaptability&#39;</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">theme</span><span class="p">,</span> <span class="n">columns</span> <span class="ow">in</span> <span class="n">riasec_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">df</span><span class="p">[</span><span class="n">theme</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Realistic&#39;</span><span class="p">,</span> <span class="s1">&#39;Investigative&#39;</span><span class="p">,</span> <span class="s1">&#39;Artistic&#39;</span><span class="p">,</span> <span class="s1">&#39;Social&#39;</span><span class="p">,</span> <span class="s1">&#39;Enterprising&#39;</span><span class="p">,</span> <span class="s1">&#39;Conventional&#39;</span><span class="p">]]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;2023 National Employment Matrix code&#39;</span><span class="p">]</span>

    <span class="n">label_encoder</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">label_encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="n">titles</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;2023 National Employment Matrix title&#39;</span><span class="p">]</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">label_encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">titles</span><span class="p">)</span>

    <span class="n">x_train</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="c1"># -----------------------</span>
    <span class="c1"># Widgets for User Input</span>
    <span class="c1"># -----------------------</span>
    <span class="n">widgets_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Realistic&#39;</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Realistic&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;Investigative&#39;</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Investigative&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;Artistic&#39;</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Artistic&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;Social&#39;</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Social&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;Enterprising&#39;</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Enterprising&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;Conventional&#39;</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Conventional&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">user_inputs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">x_new</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_user_input</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collects user input from the RIASEC widgets and stores it for prediction.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: The user input formatted into a dataframe for prediction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">x_new</span>
        <span class="k">for</span> <span class="n">feature</span><span class="p">,</span> <span class="n">widget</span> <span class="ow">in</span> <span class="n">widgets_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">user_inputs</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">value</span>

        <span class="n">x_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">user_inputs</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">x_new</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t\t\t\t\t\t</span><span class="s2"> RIASEC Mapping </span><span class="se">\t\t\t\t\t\t\t</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Submit button callback</span>
    <span class="k">def</span> <span class="nf">on_submit</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the submit button click event. Collects user input, makes predictions,</span>
<span class="sd">        and stores the results.</span>

<span class="sd">        Updates the `top_5_labels_global` and `top_5_probs_global` for prediction results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">top_5_labels_global</span><span class="p">,</span> <span class="n">top_5_probs_global</span>

        <span class="c1"># Get user inputs</span>
        <span class="n">x_new</span> <span class="o">=</span> <span class="n">get_user_input</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">x_new</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y_new_pred_prob</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
            <span class="n">top_5_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">y_new_pred_prob</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="o">-</span><span class="mi">5</span><span class="p">:][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">top_5_labels_global</span> <span class="o">=</span> <span class="n">label_encoder</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">top_5_indices</span><span class="p">)</span>
            <span class="n">top_5_probs_global</span> <span class="o">=</span> <span class="n">y_new_pred_prob</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">top_5_indices</span><span class="p">]</span>

            <span class="n">top_5_labels_global</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">top_5_labels_global</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top 5 predicted target labels for the new data:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">top_5_labels_global</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> (Probability: </span><span class="si">{</span><span class="n">top_5_probs_global</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

            <span class="n">predicted_title</span> <span class="o">=</span> <span class="n">top_5_labels_global</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Most likely job title: </span><span class="si">{</span><span class="n">predicted_title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">plot_top_5_confidence</span><span class="p">(</span><span class="n">top_5_labels_global</span><span class="p">,</span> <span class="n">top_5_probs_global</span><span class="p">)</span>

    <span class="n">submit_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Submit&quot;</span><span class="p">)</span>
    <span class="n">submit_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">on_submit</span><span class="p">)</span>

    <span class="n">display_widgets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">widget</span> <span class="ow">in</span> <span class="n">widgets_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>
        <span class="n">display_widgets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HBox</span><span class="p">([</span><span class="n">widget</span><span class="p">]))</span>

    <span class="n">display</span><span class="p">(</span><span class="n">VBox</span><span class="p">(</span><span class="n">display_widgets</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">submit_button</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Waiting for user input...&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_top_5_confidence</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots a bar chart showing the top 5 predicted labels with their confidence levels.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            labels (list): A list of top 5 predicted labels.</span>
<span class="sd">            probabilities (list): Corresponding probabilities of the predicted labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Top 5 Predicted Labels and Their Confidence&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Labels&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Confidence (Probability)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<span class="c1"># Helper function to get results from global variable after submission</span>
<div class="viewcode-block" id="get_top_5_predictions"><a class="viewcode-back" href="../modules.html#visualisation.get_top_5_predictions">[docs]</a><span class="k">def</span> <span class="nf">get_top_5_predictions</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the top 5 predicted job titles after user interaction.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        list: A list of top 5 predicted job titles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">top_5_labels_global</span></div>


<div class="viewcode-block" id="plot_education_distribution"><a class="viewcode-back" href="../modules.html#visualisation.plot_education_distribution">[docs]</a><span class="k">def</span> <span class="nf">plot_education_distribution</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df_selected</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to generate an interactive plot showing the distribution of people by education level </span>
<span class="sd">    for a selected occupation title, based on the 2023 National Employment Matrix.</span>

<span class="sd">    This function processes the input data, groups it by occupation code and education level, </span>
<span class="sd">    and provides a pie chart visualization of the total number of people by education level for </span>
<span class="sd">    the selected occupation.</span>

<span class="sd">    Args:</span>
<span class="sd">        df1 (pd.DataFrame): DataFrame containing the employment data, with columns:</span>
<span class="sd">                             - &quot;2023 National Employment Matrix code&quot;</span>
<span class="sd">                             - &quot;Typical education needed for entry&quot;</span>
<span class="sd">                             - &quot;Employment, 2023&quot;</span>
<span class="sd">        df_selected (pd.DataFrame): DataFrame containing job titles, with columns:</span>
<span class="sd">                                    - &quot;2023 National Employment Matrix code&quot;</span>
<span class="sd">                                    - &quot;2023 National Employment Matrix title&quot;</span>

<span class="sd">    Returns:</span>
<span class="sd">        panel.pane.Markdown or panel.pane.Plotly: A markdown message or an interactive pie chart</span>
<span class="sd">                                                  depending on the occupation title selected.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">grouped</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;2023 National Employment Matrix code&quot;</span><span class="p">,</span> \
                           <span class="s2">&quot;Typical education needed for entry&quot;</span><span class="p">])</span>\
                            <span class="p">[</span><span class="s2">&quot;Employment, 2023&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="n">pivot_table</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;2023 National Employment Matrix code&quot;</span><span class="p">,</span>
                                <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;Typical education needed for entry&quot;</span><span class="p">,</span>
                                <span class="n">values</span><span class="o">=</span><span class="s2">&quot;Employment, 2023&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">pivot_table</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">pivot_table</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">education_df</span> <span class="o">=</span> <span class="n">pivot_table</span>
    <span class="n">df_melted</span> <span class="o">=</span> <span class="n">education_df</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;2023 National Employment Matrix code&quot;</span><span class="p">],</span>
                                  <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;Education Level&quot;</span><span class="p">,</span>
                                  <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;Number of People&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_people_data</span><span class="p">(</span><span class="n">occupation_title</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function to plot the pie chart for the selected occupation title.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            occupation_title (str): The occupation title for which to generate the plot.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pn.pane.Plotly or pn.pane.Markdown: The Plotly pie chart or a markdown message if </span>
<span class="sd">                                                 no data is available.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">occupation_code</span> <span class="o">=</span> <span class="n">df_selected</span><span class="p">[</span><span class="n">df_selected</span>\
                                    <span class="p">[</span><span class="s1">&#39;2023 National Employment Matrix title&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">occupation_title</span><span class="p">]</span>\
                                    <span class="p">[</span><span class="s1">&#39;2023 National Employment Matrix code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">df_melted</span><span class="p">[</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;2023 National Employment Matrix code&#39;</span><span class="p">]</span>\
                                   <span class="o">==</span> <span class="n">occupation_code</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;No data available for the selected occupation code.&quot;</span><span class="p">)</span>

        <span class="n">summed_data</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Education Level&#39;</span><span class="p">)</span>\
            <span class="p">[</span><span class="s1">&#39;Number of People&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span>
            <span class="n">summed_data</span><span class="p">,</span>
            <span class="n">names</span><span class="o">=</span><span class="s1">&#39;Education Level&#39;</span><span class="p">,</span>
            <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Number of People&#39;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Total People by Education Level for </span><span class="si">{</span><span class="n">occupation_title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;Education Level&#39;</span><span class="p">,</span>
            <span class="n">color_discrete_sequence</span><span class="o">=</span><span class="n">px</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">qualitative</span><span class="o">.</span><span class="n">Set1</span>
        <span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;Education Level&quot;</span><span class="p">,</span>
            <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Number of People&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">Plotly</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">)</span>

    <span class="n">occupation_title_widget</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Select Occupation Title&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span>
            <span class="n">df_selected</span><span class="p">[</span><span class="s2">&quot;2023 National Employment Matrix title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span>  <span class="c1"># Use titles as options</span>
        <span class="n">value</span><span class="o">=</span><span class="n">df_selected</span><span class="p">[</span><span class="s2">&quot;2023 National Employment Matrix title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="c1"># Default value</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">50</span>
    <span class="p">)</span>

    <span class="n">occupation_title_widget</span><span class="o">.</span><span class="n">margin</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">interaction</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">plot_people_data</span><span class="p">,</span> <span class="n">occupation_title</span><span class="o">=</span><span class="n">occupation_title_widget</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
        <span class="n">pn</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span><span class="n">pn</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;## Total Number of People by Education Level</span><span class="se">\</span>
<span class="s2">                                 for Selected Occupation - 2023&quot;</span><span class="p">),</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">),</span>
        <span class="n">interaction</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">servable</span><span class="p">()</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Skill-Based Career Prediction and Market Insights Using Machine Learning and Hollands Code</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">data_preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html#module-employees_across_sectors">employees_across_sectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html#module-employment_and_wage_change">employment_and_wage_change</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html#module-holland_code_model">holland_code_model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html#module-visualisation">visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html#module-work_trends_2029">work_trends_2029</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebook.html">Holland career compass</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Aditya Birla, Keshav Elango, Raman Srinivas Naik (Co-Author).
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>