
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>data_preprocessing &#8212; Skill-Based Career Prediction and Market Insights Using Machine Learning and Hollands Code 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for data_preprocessing</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">data_preprocessing: Data cleaning and formatting for use in project.</span>

<span class="sd">This module contains functions clean different datasets and format them for visualisation .</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<div class="viewcode-block" id="load_and_clean_skills_occupation_data"><a class="viewcode-back" href="../modules.html#data_preprocessing.load_and_clean_skills_occupation_data">[docs]</a><span class="k">def</span> <span class="nf">load_and_clean_skills_occupation_data</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads and cleans occupation and skills data for 2023 and 2029.</span>

<span class="sd">    This function reads and cleans occupation data for the years 2023 and 2029,</span>
<span class="sd">    along with skills data for 2023. It merges the occupation data on a common</span>
<span class="sd">    occupation code and calculates changes in employment between 2023 and 2029. </span>
<span class="sd">    The skills data is loaded from a specific sheet in an Excel file, and the data</span>
<span class="sd">    frames are cleaned and prepared for analysis.</span>
<span class="sd">    The function assumes that the required Excel files are present in the</span>
<span class="sd">    &#39;project_data&#39; folder within the current working directory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple:</span>
<span class="sd">            - common_occupation_df (pd.DataFrame): Merged and cleaned occupation data </span>
<span class="sd">              for comparison, with columns such as employment figures and occupational openings.</span>

<span class="sd">            - skills_6_1 (pd.DataFrame): Merged and cleaned skills data from the &#39;Table 6.1&#39; sheet.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If the required Excel files are not found in the expected paths.</span>
<span class="sd">        ValueError: If there are issues with the structure or content of the data during cleaning.</span>

<span class="sd">    Example:</span>
<span class="sd">        common_occupation_df, skills_6_1 = load_and_clean_skills_occupation_data()</span>
<span class="sd">        print(common_occupation_df.head())</span>
<span class="sd">        print(skills_6_1.head())</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
    <span class="n">skills_path</span> <span class="o">=</span> <span class="p">(</span><span class="n">cwd</span><span class="o">/</span><span class="s1">&#39;project_data&#39;</span><span class="o">/</span><span class="s1">&#39;2023-33&#39;</span><span class="o">/</span><span class="s1">&#39;skills.xlsx&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">skills_6_1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">skills_path</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;Table 6.1&quot;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">skills_6_1</span><span class="p">[</span><span class="s1">&#39;2023 National Employment Matrix code&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">skills_6_1</span><span class="p">[</span><span class="s1">&#39;2023 National Employment Matrix code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">skills_6_1</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">skills_6_1</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">skills_6_1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">skills_6_1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="n">occ_2029_path</span> <span class="o">=</span> <span class="s1">&#39;project_data/2019-29/occupation.xlsx&#39;</span>
    <span class="n">occupation_df_2029</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">occ_2029_path</span><span class="p">,</span><span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;Table 1.2&quot;</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">occ_2023_path</span> <span class="o">=</span> <span class="s1">&#39;project_data/2023-33/occupation.xlsx&#39;</span>
    <span class="n">occupation_df_2023</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">occ_2023_path</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;Table 1.2&quot;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">occupation_df_2023</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">occupation_df_2023</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">occ_rename_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;2019 National Employment Matrix title&#39;</span><span class="p">:</span> <span class="s1">&#39;occ_title&#39;</span><span class="p">,</span>\
                       <span class="s1">&#39;2019 National Employment Matrix code&#39;</span><span class="p">:</span> <span class="s1">&#39;occ_code&#39;</span><span class="p">}</span>
    <span class="n">occupation_2029_renamed</span> <span class="o">=</span> <span class="n">occupation_df_2029</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">occ_rename_dict</span><span class="p">)</span>
    <span class="n">occ_rename_dict_23</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;2023 National Employment Matrix title&#39;</span><span class="p">:</span> <span class="s1">&#39;occ_title&#39;</span><span class="p">,</span>\
                           <span class="s1">&#39;2023 National Employment Matrix code&#39;</span><span class="p">:</span> <span class="s1">&#39;occ_code&#39;</span><span class="p">}</span>
    <span class="n">occupation_2023_renamed</span> <span class="o">=</span> <span class="n">occupation_df_2023</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">occ_rename_dict_23</span><span class="p">)</span>

    <span class="n">columns_extract_29</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;occ_title&#39;</span><span class="p">,</span> <span class="s1">&#39;occ_code&#39;</span><span class="p">,</span> <span class="s1">&#39;Employment, 2029&#39;</span><span class="p">]</span>
    <span class="n">occupation_2029_renamed</span> <span class="o">=</span> <span class="n">occupation_2029_renamed</span><span class="p">[</span><span class="n">columns_extract_29</span><span class="p">]</span>
    <span class="n">columns_extract_23</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;occ_title&#39;</span><span class="p">,</span> <span class="s1">&#39;occ_code&#39;</span><span class="p">,</span> <span class="s1">&#39;Employment, 2023&#39;</span><span class="p">]</span>
    <span class="n">occupation_2023_renamed</span> <span class="o">=</span> <span class="n">occupation_2023_renamed</span><span class="p">[</span><span class="n">columns_extract_23</span><span class="p">]</span>

    <span class="n">common_occupation_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">occupation_2029_renamed</span><span class="p">,</span> \
                                    <span class="n">occupation_2023_renamed</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;occ_code&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
    <span class="n">common_occupation_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;occ_title_y&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">common_occupation_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;occ_title_x&#39;</span><span class="p">:</span><span class="s1">&#39;occ_title&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">common_occupation_df</span><span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">common_occupation_df</span><span class="p">[</span><span class="s1">&#39;Employment, 2029&#39;</span><span class="p">]</span> <span class="o">-</span>\
                                        <span class="n">common_occupation_df</span><span class="p">[</span><span class="s1">&#39;Employment, 2023&#39;</span><span class="p">]))</span>
    <span class="n">common_occupation_df</span><span class="p">[</span><span class="s1">&#39;percent_change&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">common_occupation_df</span><span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">])</span> <span class="o">/</span> \
                                              <span class="n">common_occupation_df</span><span class="p">[</span><span class="s1">&#39;Employment, 2023&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">common_occupation_df</span> <span class="o">=</span> <span class="n">common_occupation_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span>
    <span class="n">common_occupation_df</span> <span class="o">=</span> \
        <span class="n">common_occupation_df</span><span class="p">[</span><span class="o">~</span><span class="n">common_occupation_df</span><span class="p">[</span><span class="s1">&#39;occ_code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;-0000&#39;</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">common_occupation_df</span><span class="p">,</span> <span class="n">skills_6_1</span></div>

<div class="viewcode-block" id="load_and_clean_skills_6_2_data"><a class="viewcode-back" href="../modules.html#data_preprocessing.load_and_clean_skills_6_2_data">[docs]</a><span class="k">def</span> <span class="nf">load_and_clean_skills_6_2_data</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads and cleans the Skills 6.2 data from an Excel file.</span>

<span class="sd">    This function reads the &quot;Table 6.2&quot; sheet from the Excel file located in the </span>
<span class="sd">    &#39;project_data/2023-33&#39; directory. It performs the following operations:</span>
<span class="sd">    1. Skips the first row and uses the second row as the header.</span>
<span class="sd">    2. Drops the last 6 rows of the dataset.</span>
<span class="sd">    3. Removes the first row of the dataset and resets the index.</span>
<span class="sd">    4. Splits the &#39;2023 National Employment Matrix code&#39; column by the</span>
<span class="sd">    hyphen (&#39;-&#39;) and keeps only the first part of the code.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pandas.DataFrame: The cleaned DataFrame containing the data from </span>
<span class="sd">        the &quot;Table 6.2&quot; sheet with the appropriate transformations applied.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; df = load_and_clean_skills_6_2_data()</span>
<span class="sd">        &gt;&gt;&gt; df.head()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
    <span class="n">skills_6_2_path</span> <span class="o">=</span> <span class="p">(</span><span class="n">cwd</span><span class="o">/</span><span class="s1">&#39;project_data&#39;</span><span class="o">/</span><span class="s1">&#39;2023-33&#39;</span><span class="o">/</span><span class="s1">&#39;skills.xlsx&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">skills_6_2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">skills_6_2_path</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;Table 6.2&quot;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">skills_6_2</span> <span class="o">=</span> <span class="n">skills_6_2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">skills_6_2</span> <span class="o">=</span> <span class="n">skills_6_2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">skills_6_2</span><span class="p">[</span><span class="s1">&#39;2023 National Employment Matrix code&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">skills_6_2</span><span class="p">[</span><span class="s1">&#39;2023 National Employment Matrix code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">skills_6_2</span></div>

<div class="viewcode-block" id="load_and_clean_wage_data"><a class="viewcode-back" href="../modules.html#data_preprocessing.load_and_clean_wage_data">[docs]</a><span class="k">def</span> <span class="nf">load_and_clean_wage_data</span><span class="p">(</span><span class="n">wage_data_filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load and clean wage data from an Excel file.</span>

<span class="sd">    This function reads an Excel file containing wage data, cleans the data by </span>
<span class="sd">    removing unnecessary columns, replacing special characters in specific columns,</span>
<span class="sd">    and converting the columns to numeric types. It also drops duplicates based on </span>
<span class="sd">    the &#39;OCC_TITLE&#39; column.</span>

<span class="sd">    Args:</span>
<span class="sd">        wage_data_filepath (str or Path): The path to the Excel file containing wage data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pandas.DataFrame: A cleaned DataFrame with selected columns from the wage data.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If the file at the given `wage_data_filepath` is not found.</span>
<span class="sd">        ValueError: If there are issues with data conversion during cleaning.</span>

<span class="sd">    Example:</span>
<span class="sd">        wage_data = load_and_clean_wage_data(&#39;project_data/oesm23nat/national_M2023_dl.xlsx&#39;)</span>
<span class="sd">        print(wage_data.head())    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
    <span class="c1"># wage_2023 = pd.read_excel((cwd/&#39;project_data/oesm23nat&#39;/&quot;national_M2023_dl.xlsx&quot;).resolve())</span>
    <span class="n">wage_2023</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">((</span><span class="n">cwd</span><span class="o">/</span><span class="n">wage_data_filepath</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
    <span class="n">drop_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AREA&#39;</span><span class="p">,</span><span class="s1">&#39;AREA_TITLE&#39;</span><span class="p">,</span><span class="s1">&#39;AREA_TYPE&#39;</span><span class="p">,</span><span class="s1">&#39;NAICS&#39;</span><span class="p">,</span><span class="s1">&#39;NAICS_TITLE&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;I_GROUP&#39;</span><span class="p">,</span><span class="s1">&#39;JOBS_1000&#39;</span><span class="p">,</span> <span class="s1">&#39;LOC_QUOTIENT&#39;</span><span class="p">,</span> <span class="s1">&#39;PCT_TOTAL&#39;</span><span class="p">,</span><span class="s1">&#39;PCT_RPT&#39;</span><span class="p">]</span>
    <span class="n">wage_2023</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">drop_columns</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">columns_to_replace</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;H_MEAN&#39;</span><span class="p">,</span><span class="s1">&#39;H_PCT10&#39;</span><span class="p">,</span> <span class="s1">&#39;H_PCT25&#39;</span><span class="p">,</span> <span class="s1">&#39;H_MEDIAN&#39;</span><span class="p">,</span> <span class="s1">&#39;H_PCT75&#39;</span><span class="p">,</span> <span class="s1">&#39;H_PCT90&#39;</span><span class="p">,</span>
        <span class="s1">&#39;A_MEAN&#39;</span><span class="p">,</span><span class="s1">&#39;A_PCT10&#39;</span><span class="p">,</span> <span class="s1">&#39;A_PCT25&#39;</span><span class="p">,</span> <span class="s1">&#39;A_MEDIAN&#39;</span><span class="p">,</span> <span class="s1">&#39;A_PCT75&#39;</span><span class="p">,</span> <span class="s1">&#39;A_PCT90&#39;</span>
    <span class="p">]</span>
    <span class="n">wage_2023</span><span class="p">[</span><span class="n">columns_to_replace</span><span class="p">]</span> <span class="o">=</span> <span class="n">wage_2023</span><span class="p">[</span><span class="n">columns_to_replace</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="n">wage_2023</span><span class="p">[</span><span class="n">columns_to_replace</span><span class="p">]</span> <span class="o">=</span> <span class="n">wage_2023</span><span class="p">[</span><span class="n">columns_to_replace</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">wage_2023</span><span class="p">[</span><span class="n">columns_to_replace</span><span class="p">]</span> <span class="o">=</span> <span class="n">wage_2023</span><span class="p">[</span><span class="n">columns_to_replace</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">wage_2023</span><span class="p">[</span><span class="s1">&#39;OCC_CODE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wage_2023</span><span class="p">[</span><span class="s1">&#39;OCC_CODE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
    <span class="n">wage_2023</span><span class="p">[</span><span class="s1">&#39;OCC_CODE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wage_2023</span><span class="p">[</span><span class="s1">&#39;OCC_CODE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">wage_2023</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s1">&#39;OCC_TITLE&#39;</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wage_2023</span></div>

<div class="viewcode-block" id="load_and_process_payroll_data"><a class="viewcode-back" href="../modules.html#data_preprocessing.load_and_process_payroll_data">[docs]</a><span class="k">def</span> <span class="nf">load_and_process_payroll_data</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load and process the employee payroll data from an Excel file.</span>

<span class="sd">    This function reads payroll data from the &quot;Employee_NonfarmPayrolls.xlsx&quot; file, which is located </span>
<span class="sd">    in the &quot;project_data&quot; directory. The data is processed by cleaning the numerical columns</span>
<span class="sd">    (removing commas and converting to float), then multiplying the values by 1000.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: The processed payroll DataFrame with cleaned numerical values.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If the Excel file does not exist at the specified path.</span>
<span class="sd">        ValueError: If there is an issue with the data conversion process.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">cwd</span> <span class="o">/</span> <span class="s2">&quot;project_data&quot;</span> <span class="o">/</span> <span class="s2">&quot;Employee_NonfarmPayrolls.xlsx&quot;</span>
    <span class="n">payroll_data_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="n">payroll_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">payroll_data_path</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">payroll_numerical_cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;Total&#39;</span><span class="p">,</span> <span class="s1">&#39;Mining and logging&#39;</span><span class="p">,</span> <span class="s1">&#39;Construction&#39;</span><span class="p">,</span> <span class="s1">&#39;Manufacturing&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Trade, transportation, and utilities&#39;</span><span class="p">,</span> <span class="s1">&#39;Information&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Financial activities&#39;</span><span class="p">,</span> <span class="s1">&#39;Professional and business services&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Education and health services&#39;</span><span class="p">,</span> <span class="s1">&#39;Leisure and hospitality&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Other services&#39;</span><span class="p">,</span> <span class="s1">&#39;Government&#39;</span>
    <span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">payroll_df</span><span class="p">[</span><span class="n">payroll_numerical_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">payroll_df</span><span class="p">[</span><span class="n">payroll_numerical_cols</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">payroll_df</span><span class="p">[</span><span class="n">payroll_numerical_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">payroll_df</span><span class="p">[</span><span class="n">payroll_numerical_cols</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">payroll_df</span><span class="p">[</span><span class="n">payroll_numerical_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">payroll_df</span><span class="p">[</span><span class="n">payroll_numerical_cols</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">payroll_df</span><span class="p">[</span><span class="n">payroll_numerical_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">payroll_df</span><span class="p">[</span><span class="n">payroll_numerical_cols</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing the numerical columns: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">return</span> <span class="n">payroll_df</span></div>

<div class="viewcode-block" id="process_wage_and_employment_data"><a class="viewcode-back" href="../modules.html#data_preprocessing.process_wage_and_employment_data">[docs]</a><span class="k">def</span> <span class="nf">process_wage_and_employment_data</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processes national wage and employment data from 2019 and 2023, merges the data, </span>
<span class="sd">    and returns a DataFrame with calculated employment changes and department information.</span>

<span class="sd">    This function performs the following operations:</span>
<span class="sd">    1. Reads the 2019 and 2023 national wage and employment data from Excel files.</span>
<span class="sd">    2. Merges the data for both years based on occupation code and title.</span>
<span class="sd">    3. Renames the columns for clarity.</span>
<span class="sd">    4. Calculates the total employment change and the percentage change.</span>
<span class="sd">    5. Extracts department information and adds the department number and name to the dataset.</span>
<span class="sd">    6. Cleans the data by removing rows with certain patterns.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A DataFrame containing merged and cleaned wage, employment data, </span>
<span class="sd">                      with employment changes and department information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nat_wage_2019</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;project_data/oesm19nat/national_M2019_dl.xlsx&#39;</span><span class="p">)</span>
    <span class="n">columns_to_extract</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;occ_code&#39;</span><span class="p">,</span> <span class="s1">&#39;occ_title&#39;</span><span class="p">,</span> <span class="s1">&#39;tot_emp&#39;</span><span class="p">,</span> <span class="s1">&#39;a_mean&#39;</span><span class="p">]</span>
    <span class="n">nat_wage_2019</span> <span class="o">=</span> <span class="n">nat_wage_2019</span><span class="p">[</span><span class="n">columns_to_extract</span><span class="p">]</span>

    <span class="n">nat_wage_2023</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;project_data/oesm23nat/national_M2023_dl.xlsx&#39;</span><span class="p">)</span>
    <span class="n">nat_wage_2023</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">nat_wage_2023</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">nat_wage_2023</span> <span class="o">=</span> <span class="n">nat_wage_2023</span><span class="p">[</span><span class="n">columns_to_extract</span><span class="p">]</span>

    <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">nat_wage_2019</span><span class="p">[</span><span class="n">columns_to_extract</span><span class="p">],</span>
                         <span class="n">nat_wage_2023</span><span class="p">[</span><span class="n">columns_to_extract</span><span class="p">],</span>
                         <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;occ_code&#39;</span><span class="p">,</span> <span class="s1">&#39;occ_title&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span>
                              <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_nat_wage_2019&#39;</span><span class="p">,</span> <span class="s1">&#39;_nat_wage_2023&#39;</span><span class="p">))</span>

    <span class="n">merged_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;tot_emp_nat_wage_2019&#39;</span><span class="p">:</span> <span class="s1">&#39;tot_emp_2019&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;tot_emp_nat_wage_2023&#39;</span><span class="p">:</span> <span class="s1">&#39;tot_emp_2023&#39;</span><span class="p">,</span>
        <span class="s1">&#39;a_mean_nat_wage_2019&#39;</span><span class="p">:</span> <span class="s1">&#39;annual_2019&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;a_mean_nat_wage_2023&#39;</span><span class="p">:</span> <span class="s1">&#39;annual_2023&#39;</span>
    <span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">new_column_order</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;occ_code&quot;</span><span class="p">,</span> <span class="s2">&quot;occ_title&quot;</span><span class="p">,</span> <span class="s2">&quot;tot_emp_2019&quot;</span><span class="p">,</span>\
                         <span class="s2">&quot;tot_emp_2023&quot;</span><span class="p">,</span> <span class="s2">&quot;annual_2019&quot;</span><span class="p">,</span> <span class="s2">&quot;annual_2023&quot;</span><span class="p">]</span>
    <span class="n">merged_df</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="n">new_column_order</span><span class="p">]</span>

    <span class="n">common_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">nat_wage_2019</span><span class="p">[</span><span class="n">columns_to_extract</span><span class="p">],</span>
                          <span class="n">nat_wage_2023</span><span class="p">[</span><span class="n">columns_to_extract</span><span class="p">],</span>
                         <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;occ_code&#39;</span><span class="p">,</span> <span class="s1">&#39;occ_title&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span>
                           <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_nat_wage_2019&#39;</span><span class="p">,</span> <span class="s1">&#39;_nat_wage_2023&#39;</span><span class="p">))</span>

    <span class="n">common_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;tot_emp_nat_wage_2019&#39;</span><span class="p">:</span> <span class="s1">&#39;tot_emp_2019&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;tot_emp_nat_wage_2023&#39;</span><span class="p">:</span> <span class="s1">&#39;tot_emp_2023&#39;</span><span class="p">,</span>
        <span class="s1">&#39;a_mean_nat_wage_2019&#39;</span><span class="p">:</span> <span class="s1">&#39;annual_2019&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;a_mean_nat_wage_2023&#39;</span><span class="p">:</span> <span class="s1">&#39;annual_2023&#39;</span>
    <span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;tot_emp_2023&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;tot_emp_2019&#39;</span><span class="p">]</span>
    <span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;percent_change&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;tot_emp_2019&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="n">department_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;project_data/2023-33/skills.xlsx&#39;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">department_df</span> <span class="o">=</span> <span class="n">department_df</span><span class="p">[:</span><span class="mi">23</span><span class="p">]</span>

    <span class="n">departments</span> <span class="o">=</span> <span class="p">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;2023 National Employment Matrix title&#39;</span><span class="p">]:</span>
                   <span class="n">row</span><span class="p">[</span><span class="s1">&#39;2023 National Employment Matrix code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                   <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">department_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()}</span>
    <span class="k">del</span> <span class="n">departments</span><span class="p">[</span><span class="s1">&#39;Total, all occupations&#39;</span><span class="p">]</span>
    <span class="n">departments</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">departments</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;department_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;occ_code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;department_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;department_number&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
        <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">departments</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>

    <span class="n">common_df</span> <span class="o">=</span> <span class="n">common_df</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">common_df</span> <span class="o">=</span> <span class="n">common_df</span><span class="p">[</span><span class="o">~</span><span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;occ_code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;-0000&#39;</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">common_df</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Skill-Based Career Prediction and Market Insights Using Machine Learning and Hollands Code</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">data_preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html#module-employees_across_sectors">employees_across_sectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html#module-employment_and_wage_change">employment_and_wage_change</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html#module-holland_code_model">holland_code_model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html#module-visualisation">visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html#module-work_trends_2029">work_trends_2029</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebook.html">Holland career compass</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Aditya Birla, Keshav Elango, Raman Srinivas Naik (Co-Author).
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>